!function(t){if(!t.preview){t.assetContainers.main.isExpandable=!0;try{var e=!!window.frameElement,n=e?window.frameElement.parentNode.firstChild.firstChild.contentWindow:window;t.overrides=t.overrides||{},t.overrides.displayWindowTarget=n}catch(t){console.warn("Failed to find target iframe in player environment: Has the structure changed?\n",t)}}var i=!1;if(!t.overrides||t.overrides.displayWindowTarget!=self)for(var a in t.assetContainers)if(t.assetContainers.hasOwnProperty(a)){var o=t.assetContainers[a];if("inlineDiv"!=o.type||o.isExpandable){i=!0;break}}if(t.overrides&&t.overrides.displayWindowTarget){var d=t.overrides.displayWindowTarget;d="undefined"!=typeof adtechIframeHashArray&&self!=top?d.parent:d}else{for(var r=null,s=parent;void 0!=s;){try{var c=s.document;c&&(r=s)}catch(t){}s=s==top?null:s.parent}var d=r||top}var h=!1;try{var c=d.document;c&&(h=!0)}catch(t){}var l=i&&self!=top&&h?d:self;l.com=l.com||{},l.com.adtech=l.com.adtech||{},l.com.adtech.AdtechCustomAd$AD_ID$=function(){};var v=l.com.adtech.AdtechCustomAd$AD_ID$;v.prototype.elem={},v.prototype.elem.topWin=window.parent,v.prototype.elem.targetWindow=l,v.prototype.tools={events:{triggerEvent:function(t,e){var n;document.createEvent?(n=document.createEvent("HTMLEvents"),n.initEvent(e,!0,!0)):document.createEventObject&&(n=document.createEventObject(),n.eventType=e),n.eventName=e,t.dispatchEvent?t.dispatchEvent(n):t.fireEvent&&htmlEvents["on"+e]?t.fireEvent("on"+n.eventType,n):t[e]?t[e]():t["on"+e]&&t["on"+e]()},addEvent:function(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&htmlEvents["on"+e]?t.attachEvent("on"+e,n):t["on"+e]=n},removeEvent:function(t,e,n){t.removeventListener?t.removeEventListener(e,n,!1):t.detachEvent&&htmlEvents["on"+e]?t.detachEvent("on"+e,n):t["on"+e]=null}},mask:function(t,e){},getPercentage:function(t,e){return t/100*e},getSizeStyle:function(t,e){var n=(this.tools,{}),i=parseInt(t,10),t=t.split(i)[1];return data={num:isNaN(parseFloat(i))?0:i,val:void 0!==t?t:"px"},"%"==data.val?(n.px=Math.round(e/100*data.num),n.percent=data.num):(n.px=data.num,n.percent=data.num/e*100),n},getViewportSize:function(t){if(t=t||window,null!=t.innerWidth)return{w:t.innerWidth,h:t.innerHeight};var e=t.document;return"CSS1Compat"==document.compatMode?{w:e.documentElement.clientWidth,h:e.documentElement.clientHeight}:{w:e.body.clientWidth,h:e.body.clientHeight}}},v.prototype.declareEvents=function(t){ADTECH.event("RYOT_PARENT_META"),ADTECH.event("RYOT_RESIZE"),ADTECH.event("RYOT_FILLWIDTH"),ADTECH.event("RYOT_CHILD_META"),ADTECH.event("RYOT_CHILD_RESIZE")},v.prototype.preInit=function(){null!=window&&(window.com=com||{},com.adtech=window.com.adtech)},v.prototype.init=function(t){this.advert=t,this.elem.adContainer=t.assetContainers.main.anchorDiv,this.elem.adContent=t.assetContainers.main.anchorDiv.firstChild,this.elem.adIframe=this.elem.adContent.getElementsByTagName("iframe")[0],this.elem.adBody=document||this.elem.adIframe.contentWindow.document,this.lib={},this.lib.utils=l.com.adtech.Utils_$VERSION$,this.lib.globalEventBus=l.adtechAdManager_$VERSION$.globalEventBus,this.lib.richMediaEvent=l.com.adtech.RichMediaEvent_$VERSION$,this.metaData={},this.recieveMeta()},v.prototype.data={topPosition:0,scrollTop:0,winWidth:0,winHeight:0,docHeight:0},v.prototype.whenReady=function(){this.handleParentData(),this.sendMeta()},v.prototype.handleParentData=function(){this.setupScrollData(),this.getAdWrapperPosition(),this.setAdHeight(),this.setupResize(),this.elem.adIframe.contentWindow.focus()},v.prototype.dispatchEvent=function(t,e){var n=new this.lib.richMediaEvent(t),e=e||{};n.meta=e,this.advert.eventBus.dispatchEvent(n)},v.prototype.sendMeta=function(){var t=this;setInterval(function(){t.dispatchEvent("RYOT_PARENT_META",t.data)},100)},v.prototype.recieveMeta=function(){var t=this;this.advert.eventBus.addEventListener("RYOT_CHILD_META",function(e){t.data.docHeight=e.meta.docHeight,t.setAdHeight(e.meta.docHeight,!0),t.whenReady()}),this.advert.eventBus.addEventListener("RYOT_FILLWIDTH",function(e){t.setAdToFillContainer(),t.setAdHeight(t.data.docHeight)})},v.prototype.getAdWrapperPosition=function(){var t=this.elem.adContainer,e=document.body.getBoundingClientRect(),n=t.getBoundingClientRect(),i=n.top-e.top;this.data.topPosition=i},v.prototype.setupScrollData=function(){function t(){var t=document.documentElement;return(window.pageYOffset||t.scrollTop)-(t.clientTop||0)}function e(e){n.data.scrollTop=t()}var n=this;window.addEventListener("scroll",e,!1);t(),(new Date).getTime();this.data.scrollTop=t()},v.prototype.setupResize=function(){var t=this,e=t.getWindowSize();t.data.winWidth=e.width,t.data.winHeight=e.height,window.addEventListener("resize",function(){t.dispatchEvent("RYOT_RESIZE",t.data)},!0),this.advert.eventBus.addEventListener("RYOT_CHILD_RESIZE",function(e){var n=t.getWindowSize();t.data.winWidth=n.width,t.data.winHeight=n.height,t.setAdHeight(e.meta.docHeight)})},v.prototype.getWindowSize=function(){var t=window,e=document,n=e.documentElement,i=e.getElementsByTagName("body")[0];return{width:t.innerWidth||n.clientWidth||i.clientWidth,height:t.innerHeight||n.clientHeight||i.clientHeight}},v.prototype.setAdHeight=function(t,e){if(void 0!==t){var n=this.elem.adContainer,i=this.elem.adContent,a=i.firstChild;this.elem.docBody;n.style.height="auto",i.style.clip="",n.style.position="absolute",n.style.left=0,n.style.top=0,t===this.data.docHeight&&1!=e||(n.style.height=t+"px",i.style.height=t+"px",a.style.height=t+"px",this.data.docHeight=t)}},v.prototype.setAdToFillContainer=function(){var t=this.elem.adContainer,e=this.elem.adContent,n=e.firstChild;this.elem.docBody;t.style.width="100%",e.style.width="100%",n.style.width="100%",n.width="100%",this.setAdHeight()},l.adtechCallbackInstances=l.adtechCallbackInstances||[];var p=l.adtechCallbackInstances.length;l.adtechCallbackInstances[p]=new l.com.adtech.AdtechCustomAd$AD_ID$,l.adtechAdCallbacks=l.adtechAdCallbacks||{},l.adtechAdCallbacks[t.adServerVars.uid]=l.adtechAdCallbacks[t.adServerVars.uid]||[],l.adtechAdCallbacks[t.adServerVars.uid].push(l.adtechCallbackInstances[p])}(adtechAdConfig);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImN1c3RvbUFkLndyYXBwZXIuanMiXSwibmFtZXMiOlsiYWRDb25maWciLCJwcmV2aWV3IiwiYXNzZXRDb250YWluZXJzIiwibWFpbiIsImlzRXhwYW5kYWJsZSIsInBhcmVudENoZWNrIiwid2luZG93IiwiZnJhbWVFbGVtZW50IiwidGFyZ2V0V2luIiwicGFyZW50Tm9kZSIsImZpcnN0Q2hpbGQiLCJjb250ZW50V2luZG93Iiwib3ZlcnJpZGVzIiwiZGlzcGxheVdpbmRvd1RhcmdldCIsImUiLCJjb25zb2xlIiwid2FybiIsInJlcXVpcmVzQnJlYWtvdXQiLCJzZWxmIiwiaWQiLCJoYXNPd25Qcm9wZXJ0eSIsImNvbnRhaW5lciIsInR5cGUiLCJhZHRlY2hJZnJhbWVIYXNoQXJyYXkiLCJ0b3AiLCJwYXJlbnQiLCJjYWxjdWxhdGVkVGFyZ2V0IiwiY3VycmVudFdpbmRvdyIsInVuZGVmaW5lZCIsInRhcmdldERvYyIsImRvY3VtZW50IiwidGFyZ2V0SXNGcmllbmRseSIsInRhcmdldFdpbmRvdyIsImNvbSIsImFkdGVjaCIsIkFkdGVjaEN1c3RvbUFkJEFEX0lEJCIsImN1c3RvbUFkIiwicHJvdG90eXBlIiwiZWxlbSIsInRvcFdpbiIsInRvb2xzIiwiZXZlbnRzIiwidHJpZ2dlckV2ZW50IiwiZWwiLCJldmVudE5hbWUiLCJldmVudCIsImNyZWF0ZUV2ZW50IiwiaW5pdEV2ZW50IiwiY3JlYXRlRXZlbnRPYmplY3QiLCJldmVudFR5cGUiLCJkaXNwYXRjaEV2ZW50IiwiZmlyZUV2ZW50IiwiaHRtbEV2ZW50cyIsImFkZEV2ZW50IiwiaGFuZGxlciIsImFkZEV2ZW50TGlzdGVuZXIiLCJhdHRhY2hFdmVudCIsInJlbW92ZUV2ZW50IiwicmVtb3ZldmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImRldGFjaEV2ZW50IiwibWFzayIsInZhbCIsImdldFBlcmNlbnRhZ2UiLCJudW0iLCJwZXJjZW50YWdlIiwiZ2V0U2l6ZVN0eWxlIiwic2l6ZSIsInByb2Nlc3NlZCIsInRoaXMiLCJwYXJzZUludCIsInNwbGl0IiwiZGF0YSIsImlzTmFOIiwicGFyc2VGbG9hdCIsIk1hdGgiLCJyb3VuZCIsImdldFZpZXdwb3J0U2l6ZSIsInciLCJpbm5lcldpZHRoIiwiaCIsImlubmVySGVpZ2h0IiwiZCIsImNvbXBhdE1vZGUiLCJkb2N1bWVudEVsZW1lbnQiLCJjbGllbnRXaWR0aCIsImNsaWVudEhlaWdodCIsImJvZHkiLCJkZWNsYXJlRXZlbnRzIiwiYWR2ZXJ0IiwiQURURUNIIiwicHJlSW5pdCIsImluaXQiLCJhZENvbnRhaW5lciIsImFuY2hvckRpdiIsImFkQ29udGVudCIsImFkSWZyYW1lIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJhZEJvZHkiLCJsaWIiLCJ1dGlscyIsIlV0aWxzXyRWRVJTSU9OJCIsImdsb2JhbEV2ZW50QnVzIiwiYWR0ZWNoQWRNYW5hZ2VyXyRWRVJTSU9OJCIsInJpY2hNZWRpYUV2ZW50IiwiUmljaE1lZGlhRXZlbnRfJFZFUlNJT04kIiwibWV0YURhdGEiLCJyZWNpZXZlTWV0YSIsInRvcFBvc2l0aW9uIiwic2Nyb2xsVG9wIiwid2luV2lkdGgiLCJ3aW5IZWlnaHQiLCJkb2NIZWlnaHQiLCJ3aGVuUmVhZHkiLCJoYW5kbGVQYXJlbnREYXRhIiwic2VuZE1ldGEiLCJzZXR1cFNjcm9sbERhdGEiLCJnZXRBZFdyYXBwZXJQb3NpdGlvbiIsInNldEFkSGVpZ2h0Iiwic2V0dXBSZXNpemUiLCJmb2N1cyIsIm1ldGEiLCJldmVudEJ1cyIsInNldEludGVydmFsIiwic2V0QWRUb0ZpbGxDb250YWluZXIiLCJlbGVtZW50IiwiYm9keVJlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJlbGVtUmVjdCIsImdldFNjcm9sbFRvcCIsImRvYyIsInBhZ2VZT2Zmc2V0IiwiY2xpZW50VG9wIiwid2hlZWwiLCJEYXRlIiwiZ2V0VGltZSIsIndpblNpemUiLCJnZXRXaW5kb3dTaXplIiwid2lkdGgiLCJoZWlnaHQiLCJnIiwiZm9yY2UiLCJ0b3BXcmFwcGVyIiwiY29udGVudFdyYXBwZXIiLCJpZnJhbWUiLCJkb2NCb2R5Iiwic3R5bGUiLCJjbGlwIiwicG9zaXRpb24iLCJsZWZ0IiwiYWR0ZWNoQ2FsbGJhY2tJbnN0YW5jZXMiLCJpbnN0YW5jZUluZGV4IiwibGVuZ3RoIiwiYWR0ZWNoQWRDYWxsYmFja3MiLCJhZFNlcnZlclZhcnMiLCJ1aWQiLCJwdXNoIiwiYWR0ZWNoQWRDb25maWciXSwibWFwcGluZ3MiOiJDQUtBLFNBQVVBLEdBTVIsSUFBS0EsRUFBU0MsUUFBUyxDQUNyQkQsRUFBU0UsZ0JBQWdCQyxLQUFLQyxjQUFlLENBQzdDLEtBQ0UsR0FBSUMsS0FBY0MsT0FBT0MsYUFDckJDLEVBQVlILEVBQWNDLE9BQU9DLGFBQWFFLFdBQVdDLFdBQVdBLFdBQVdDLGNBQWdCTCxNQUNuR04sR0FBU1ksVUFBWVosRUFBU1ksY0FDOUJaLEVBQVNZLFVBQVVDLG9CQUFzQkwsRUFDekMsTUFBTU0sR0FDTkMsUUFBUUMsS0FBSyxtRkFBb0ZGLElBSXJHLEdBQUlHLElBQW1CLENBQ3ZCLEtBQUtqQixFQUFTWSxXQUFhWixFQUFTWSxVQUFVQyxxQkFBdUJLLEtBQ25FLElBQUssR0FBSUMsS0FBTW5CLEdBQVNFLGdCQUN0QixHQUFJRixFQUFTRSxnQkFBZ0JrQixlQUFlRCxHQUFLLENBQy9DLEdBQUlFLEdBQVlyQixFQUFTRSxnQkFBZ0JpQixFQUN6QyxJQUFzQixhQUFsQkUsRUFBVUMsTUFBdUJELEVBQVVqQixhQUFjLENBQzNEYSxHQUFtQixDQUNuQixRQU1SLEdBQUlqQixFQUFTWSxXQUFhWixFQUFTWSxVQUFVQyxvQkFBcUIsQ0FDaEUsR0FBSUEsR0FBc0JiLEVBQVNZLFVBQVVDLG1CQUM3Q0EsR0FBdUQsbUJBQXpCVSx3QkFBd0NMLE1BQVFNLElBQzFFWCxFQUFvQlksT0FBU1osTUFDNUIsQ0FHTCxJQUZBLEdBQUlhLEdBQW1CLEtBQ25CQyxFQUFnQkYsV0FDSUcsSUFBakJELEdBQTRCLENBQ2pDLElBQ0UsR0FBSUUsR0FBWUYsRUFB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QUsyRyxPQUl4QkgsR0FBV0ksTUFBTVAsT0FBUyxPQUcxQkksRUFBZUcsTUFBTUMsS0FBTyxHQUM1QkwsRUFBV0ksTUFBTUUsU0FBVyxXQUM1Qk4sRUFBV0ksTUFBTUcsS0FBTyxFQUN4QlAsRUFBV0ksTUFBTTFILElBQU0sRUFFbkJtSCxJQUFTdEUsS0FBS0csS0FBS3dDLFdBQW9CLEdBQVA2QixJQU1sQ0MsRUFBV0ksTUFBTVAsT0FBU0EsRUFBUyxLQUduQ0ksRUFBZUcsTUFBTVAsT0FBU0EsRUFBUyxLQUd2Q0ssRUFBT0UsTUFBTVAsT0FBU0EsRUFBUyxLQUcvQnRFLEtBQUtHLEtBQUt3QyxVQUFZMkIsS0FJMUJ2RyxFQUFTQyxVQUFVdUYscUJBQXVCLFdBRXhDLEdBQUlrQixHQUFhekUsS0FBSy9CLEtBQUt1RCxZQUN2QmtELEVBQWlCMUUsS0FBSy9CLEtBQUt5RCxVQUMzQmlELEVBQVNELEVBQWVySSxVQUNkMkQsTUFBSy9CLEtBQUsyRyxPQUV4QkgsR0FBV0ksTUFBTVIsTUFBUSxPQUN6QkssRUFBZUcsTUFBTVIsTUFBUSxPQUM3Qk0sRUFBT0UsTUFBTVIsTUFBUSxPQUNyQk0sRUFBT04sTUFBUSxPQUdmckUsS0FBS2lELGVBR1B0RixFQUFhc0gsd0JBQTBCdEgsRUFBYXNILDJCQUNwRCxJQUFJQyxHQUFnQnZILEVBQWFzSCx3QkFBd0JFLE1BQ3pEeEgsR0FBYXNILHdCQUF3QkMsR0FBaUIsR0FBSXZILEdBQWFDLElBQUlDLE9BQU9DLHNCQUVsRkgsRUFBYXlILGtCQUFvQnpILEVBQWF5SCxzQkFDOUN6SCxFQUFheUgsa0JBQWtCekosRUFBUzBKLGFBQWFDLEtBQ2pEM0gsRUFBYXlILGtCQUFrQnpKLEVBQVMwSixhQUFhQyxTQUN6RDNILEVBQWF5SCxrQkFBa0J6SixFQUFTMEosYUFBYUMsS0FBS0MsS0FDdEQ1SCxFQUFhc0gsd0JBQXdCQyxLQUN4Q00iLCJmaWxlIjoiY3VzdG9tQWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEJvaWxlcnBsYXRlIGNvZGUgcmVxdWlyZWQgdG8gaG9vayBpbnRvIHRoZSBBRFRFQ0ggcmljaCBtZWRpYSBsaWJyYXJ5LlxuICpcbiAqIEZvciBBUEkgZG9jdW1lbnRhdGlvbiwgcGxlYXNlIGNvbnRhY3QgY2FudmFzLWhlbHBAYWR0ZWNoLmNvbVxuICovXG4oZnVuY3Rpb24oYWRDb25maWcpIHtcblxuICAvKlxuICAgKiBWaWRpYmxlIGNoZWNrXG4gICAqIFRoaXMgYXNzaWducyB0aGUgdmlkaWJsZSBwYXJlbnQgd2luZG93IGFzIHRoZSB0YXJnZXQgd2luZG93XG4gICAqL1xuICBpZiAoIWFkQ29uZmlnLnByZXZpZXcpIHtcbiAgICBhZENvbmZpZy5hc3NldENvbnRhaW5lcnMubWFpbi5pc0V4cGFuZGFibGUgPSB0cnVlO1xuICAgIHRyeSB7XG4gICAgICB2YXIgcGFyZW50Q2hlY2sgPSB3aW5kb3cuZnJhbWVFbGVtZW50ID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgdmFyIHRhcmdldFdpbiA9IHBhcmVudENoZWNrID8gd2luZG93LmZyYW1lRWxlbWVudC5wYXJlbnROb2RlLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5jb250ZW50V2luZG93IDogd2luZG93O1xuICAgICAgYWRDb25maWcub3ZlcnJpZGVzID0gYWRDb25maWcub3ZlcnJpZGVzIHx8IHt9O1xuICAgICAgYWRDb25maWcub3ZlcnJpZGVzLmRpc3BsYXlXaW5kb3dUYXJnZXQgPSB0YXJnZXRXaW47XG4gICAgfSBjYXRjaChlKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBmaW5kIHRhcmdldCBpZnJhbWUgaW4gcGxheWVyIGVudmlyb25tZW50OiBIYXMgdGhlIHN0cnVjdHVyZSBjaGFuZ2VkP1xcbicsIGUpO1xuICAgIH1cbiAgfVxuICBcbiAgdmFyIHJlcXVpcmVzQnJlYWtvdXQgPSBmYWxzZTtcbiAgaWYgKCFhZENvbmZpZy5vdmVycmlkZXMgfHwgYWRDb25maWcub3ZlcnJpZGVzLmRpc3BsYXlXaW5kb3dUYXJnZXQgIT0gc2VsZikge1xuICAgIGZvciAodmFyIGlkIGluIGFkQ29uZmlnLmFzc2V0Q29udGFpbmVycykge1xuICAgICAgaWYgKGFkQ29uZmlnLmFzc2V0Q29udGFpbmVycy5oYXNPd25Qcm9wZXJ0eShpZCkpIHtcbiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGFkQ29uZmlnLmFzc2V0Q29udGFpbmVyc1tpZF07XG4gICAgICAgIGlmIChjb250YWluZXIudHlwZSAhPSAnaW5saW5lRGl2JyB8fCBjb250YWluZXIuaXNFeHBhbmRhYmxlKSB7XG4gICAgICAgICAgcmVxdWlyZXNCcmVha291dCA9IHRydWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoYWRDb25maWcub3ZlcnJpZGVzICYmIGFkQ29uZmlnLm92ZXJyaWRlcy5kaXNwbGF5V2luZG93VGFyZ2V0KSB7XG4gICAgdmFyIGRpc3BsYXlXaW5kb3dUYXJnZXQgPSBhZENvbmZpZy5vdmVycmlkZXMuZGlzcGxheVdpbmRvd1RhcmdldDtcbiAgICBkaXNwbGF5V2luZG93VGFyZ2V0ID0gKHR5cGVvZiBhZHRlY2hJZnJhbWVIYXNoQXJyYXkgIT0gJ3VuZGVmaW5lZCcgJiYgc2VsZiAhPSB0b3ApID9cbiAgICAgICAgZGlzcGxheVdpbmRvd1RhcmdldC5wYXJlbnQgOiBkaXNwbGF5V2luZG93VGFyZ2V0O1xuICB9IGVsc2Uge1xuICAgIHZhciBjYWxjdWxhdGVkVGFyZ2V0ID0gbnVsbDtcbiAgICB2YXIgY3VycmVudFdpbmRvdyA9IHBhcmVudDtcbiAgICB3aGlsZSAoY3VycmVudFdpbmRvdyAhPSB1bmRlZmluZWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciB0YXJnZXREb2MgPSBjdXJyZW50V2luZG93LmRvY3VtZW50O1xuICAgICAgICBpZiAodGFyZ2V0RG9jKSB7XG4gICAgICAgICAgY2FsY3VsYXRlZFRhcmdldCA9IGN1cnJlbnRXaW5kb3c7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2goZSkge31cbiAgICAgIGN1cnJlbnRXaW5kb3cgPSAoY3VycmVudFdpbmRvdyA9PSB0b3ApID8gbnVsbCA6IGN1cnJlbnRXaW5kb3cucGFyZW50O1xuICAgIH1cbiAgICB2YXIgZGlzcGxheVdpbmRvd1RhcmdldCA9IGNhbGN1bGF0ZWRUYXJnZXQgfHwgdG9wO1xuICB9XG5cbiAgdmFyIHRhcmdldElzRnJpZW5kbHkgPSBmYWxzZTtcbiAgdHJ5IHtcbiAgICB2YXIgdGFyZ2V0RG9jID0gZGlzcGxheVdpbmRvd1RhcmdldC5kb2N1bWVudDtcbiAgICBpZiAodGFyZ2V0RG9jKSB7XG4gICAgICB0YXJnZXRJc0ZyaWVuZGx5ID0gdHJ1ZTtcbiAgICB9XG4gIH0gY2F0Y2goZSkge31cblxuICB2YXIgdGFyZ2V0V2luZG93ID0gKHJlcXVpcmVzQnJlYWtvdXQgJiYgKHNlbGYgIT0gdG9wICYmIHRhcmdldElzRnJpZW5kbHkpKSA/XG4gICAgICAgICAgZGlzcGxheVdpbmRvd1RhcmdldCA6IHNlbGY7XG4gIFxuICB0YXJnZXRXaW5kb3cuY29tID0gdGFyZ2V0V2luZG93LmNvbSB8fCB7fTtcbiAgdGFyZ2V0V2luZG93LmNvbS5hZHRlY2ggPSB0YXJnZXRXaW5kb3cuY29tLmFkdGVjaCB8fCB7fTtcblxuICAvKlxuICAgKiBDdXN0b21BZC5qcyBDb25zdHJ1Y3RvclxuICAgKi9cbiAgdGFyZ2V0V2luZG93LmNvbS5hZHRlY2guQWR0ZWNoQ3VzdG9tQWQkQURfSUQkID0gZnVuY3Rpb24oKSB7fTtcbiAgXG4gIC8qXG4gICAqIEluY2x1ZGUgcGFydGlhbHNcbiAgICovXG4gIC8vIENvcmUgY2xhc3NcbiAgLyoqXG4gICAqIEN1c3RvbUFkLmpzIFByb3RvdHlwZSAtIGF0dGFjaGVkIHRvIEN1c3RvbUFkIHByb3RvdHlwZVxuICAgKi9cbiAgdmFyIGN1c3RvbUFkID0gdGFyZ2V0V2luZG93LmNvbS5hZHRlY2guQWR0ZWNoQ3VzdG9tQWQkQURfSUQkO1xuICBcbiAgLy8gQWRkIHdpbmRvdyBvYmplY3RzIHRvIGVsZW1lbnRzIHByb3BlcnR5XG4gIGN1c3RvbUFkLnByb3RvdHlwZS5lbGVtID0ge307XG4gIGN1c3RvbUFkLnByb3RvdHlwZS5lbGVtLnRvcFdpbiA9IHdpbmRvdy5wYXJlbnQ7XG4gIGN1c3RvbUFkLnByb3RvdHlwZS5lbGVtLnRhcmdldFdpbmRvdyA9IHRhcmdldFdpbmRvdztcbiAgXG4gIC8vIFRvb2xraXRcbiAgLyoqXG4gICAqIEN1c3RvbSBBZCBUb29sc1xuICAgKi9cbiAgY3VzdG9tQWQucHJvdG90eXBlLnRvb2xzID0ge1xuICAgIGV2ZW50cyA6IHtcbiAgICAgIHRyaWdnZXJFdmVudCA6IGZ1bmN0aW9uKGVsLCBldmVudE5hbWUpe1xuICAgICAgICB2YXIgZXZlbnQ7XG4gICAgICAgIGlmIChkb2N1bWVudC5jcmVhdGVFdmVudCkge1xuICAgICAgICAgIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0hUTUxFdmVudHMnKTtcbiAgICAgICAgICBldmVudC5pbml0RXZlbnQoZXZlbnROYW1lLCB0cnVlLCB0cnVlKTtcbiAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5jcmVhdGVFdmVudE9iamVjdCkgey8vIElFIDwgOVxuICAgICAgICAgIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnRPYmplY3QoKTtcbiAgICAgICAgICBldmVudC5ldmVudFR5cGUgPSBldmVudE5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgZXZlbnQuZXZlbnROYW1lID0gZXZlbnROYW1lO1xuICAgICAgICBpZiAoZWwuZGlzcGF0Y2hFdmVudCkge1xuICAgICAgICAgIGVsLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICAgICAgICB9IGVsc2UgaWYgKGVsLmZpcmVFdmVudCAmJiBodG1sRXZlbnRzWydvbicrZXZlbnROYW1lXSkgey8vIElFIDwgOVxuICAgICAgICAgIGVsLmZpcmVFdmVudCgnb24nK2V2ZW50LmV2ZW50VHlwZSxldmVudCk7Ly8gY2FuIHRyaWdnZXIgb25seSByZWFsIGV2ZW50IChlLmcuICdjbGljaycpXG4gICAgICAgIH0gZWxzZSBpZiAoZWxbZXZlbnROYW1lXSl7XG4gICAgICAgICAgZWxbZXZlbnROYW1lXSgpO1xuICAgICAgICB9IGVsc2UgaWYgKGVsWydvbicrZXZlbnROYW1lXSkge1xuICAgICAgICAgIGVsWydvbicrZXZlbnROYW1lXSgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYWRkRXZlbnQgOiBmdW5jdGlvbihlbCwgdHlwZSwgaGFuZGxlcil7XG4gICAgICAgIGlmIChlbC5hZGRFdmVudExpc3RlbmVyKSB7XG4gICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLGhhbmRsZXIsZmFsc2UpO1xuICAgICAgICB9IGVsc2UgaWYgKGVsLmF0dGFjaEV2ZW50ICYmIGh0bWxFdmVudHNbJ29uJyt0eXBlXSl7Ly8gSUUgPCA5XG4gICAgICAgICAgZWwuYXR0YWNoRXZlbnQoJ29uJyt0eXBlLGhhbmRsZXIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVsWydvbicrdHlwZV09aGFuZGxlcjtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlbW92ZUV2ZW50IDogZnVuY3Rpb24oZWwsIHR5cGUsIGhhbmRsZXIpe1xuICAgICAgICBpZihlbC5yZW1vdmV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsaGFuZGxlcixmYWxzZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZWwuZGV0YWNoRXZlbnQgJiYgaHRtbEV2ZW50c1snb24nK3R5cGVdKXsvLyBJRSA8IDlcbiAgICAgICAgICBlbC5kZXRhY2hFdmVudCgnb24nK3R5cGUsaGFuZGxlcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZWxbJ29uJyt0eXBlXT1udWxsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBtYXNrIDogZnVuY3Rpb24oZWxlbSwgdmFsKSB7XG4gICAgICAvLyBlbGVtLnN0eWxlLmNsaXAgPSAncmVjdCgnK3ZhbCsnKSc7XG4gICAgfSxcbiAgICBnZXRQZXJjZW50YWdlIDogZnVuY3Rpb24obnVtLCBwZXJjZW50YWdlKSB7XG4gICAgICByZXR1cm4gKG51bSAvIDEwMCkgKiBwZXJjZW50YWdlO1xuICAgIH0sXG4gICAgLypcbiAgICAgKiBSZXR1cm4gcGl4ZWwgKyBwZXJjZW50IHZhbHVlcyBmcm9tIGludGVnZXIgLyBzdHJpbmcgLCBlZyAnMTAlJ1xuICAgICAqL1xuICAgIGdldFNpemVTdHlsZSA6IGZ1bmN0aW9uKHZhbCwgc2l6ZSkge1xuICAgICAgLy8gY29uc29sZS5sb2codmFsLCBzaXplKVxuICAgICAgdmFyIHRvb2xzID0gdGhpcy50b29scztcbiAgICAgIHZhciBwcm9jZXNzZWQgPSB7fTtcbiAgICAgIHZhciBudW0gPSBwYXJzZUludCh2YWwsIDEwKTtcbiAgICAgIHZhciB2YWwgPSB2YWwuc3BsaXQobnVtKVsxXTtcbiAgICAgIGRhdGEgPSB7XG4gICAgICAgIG51bSA6IChpc05hTihwYXJzZUZsb2F0KChudW0pKSkgPyAwIDogbnVtKSxcbiAgICAgICAgdmFsIDogKHR5cGVvZiB2YWwhPT0ndW5kZWZpbmVkJyA/IHZhbCA6ICdweCcpXG4gICAgICB9XG4gICAgICBpZiAoZGF0YS52YWw9PSclJykge1xuICAgICAgICBwcm9jZXNzZWRbJ3B4J10gPSBNYXRoLnJvdW5kKChzaXplIC8gMTAwKSAqIGRhdGEubnVtKTtcbiAgICAgICAgcHJvY2Vzc2VkWydwZXJjZW50J10gPSBkYXRhLm51bTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHByb2Nlc3NlZFsncHgnXSA9IGRhdGEubnVtO1xuICAgICAgICBwcm9jZXNzZWRbJ3BlcmNlbnQnXSA9IGRhdGEubnVtIC8gc2l6ZSAqIDEwMDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwcm9jZXNzZWQ7XG4gICAgfSxcbiAgICBnZXRWaWV3cG9ydFNpemUgOiBmdW5jdGlvbih3KSB7XG4gICAgICAvLyBVc2UgdGhlIHNwZWNpZmllZCB3aW5kb3cgb3IgdGhlIGN1cnJlbnQgd2luZG93IGlmIG5vIGFyZ3VtZW50XG4gICAgICB3ID0gdyB8fCB3aW5kb3c7XG4gIFxuICAgICAgLy8gVGhpcyB3b3JrcyBmb3IgYWxsIGJyb3dzZXJzIGV4Y2VwdCBJRTggYW5kIGJlZm9yZVxuICAgICAgaWYgKHcuaW5uZXJXaWR0aCAhPSBudWxsKSByZXR1cm4geyB3OiB3LmlubmVyV2lkdGgsIGg6IHcuaW5uZXJIZWlnaHQgfTtcbiAgXG4gICAgICAvLyBGb3IgSUUgKG9yIGFueSBicm93c2VyKSBpbiBTdGFuZGFyZHMgbW9kZVxuICAgICAgdmFyIGQgPSB3LmRvY3VtZW50O1xuICAgICAgaWYgKGRvY3VtZW50LmNvbXBhdE1vZGUgPT0gXCJDU1MxQ29tcGF0XCIpXG4gICAgICAgICAgcmV0dXJuIHsgdzogZC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgsXG4gICAgICAgICAgICAgaDogZC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IH07XG4gIFxuICAgICAgLy8gRm9yIGJyb3dzZXJzIGluIFF1aXJrcyBtb2RlXG4gICAgICByZXR1cm4geyB3OiBkLmJvZHkuY2xpZW50V2lkdGgsIGg6IGQuYm9keS5jbGllbnRIZWlnaHQgfTtcbiAgICB9XG4gIH07XG4gIFxuICAvKipcbiAgICogRXZlbnRzIGxpc3RcbiAgICogVGhpcyBtZXRob2QgaXMgbmV2ZXIgdXNlZCwgb25seSBoZXJlIGZvciBPTkUgdG8gcGFyc2VcbiAgICovXG4gIGN1c3RvbUFkLnByb3RvdHlwZS5kZWNsYXJlRXZlbnRzID0gZnVuY3Rpb24oYWR2ZXJ0KSB7XG4gICAgXG4gICAgLy8gUGFyZW50IGV2ZW50c1xuICAgIEFEVEVDSC5ldmVudCgnUllPVF9QQVJFTlRfTUVUQScpO1xuICAgIEFEVEVDSC5ldmVudCgnUllPVF9SRVNJWkUnKTtcbiAgICBBRFRFQ0guZXZlbnQoJ1JZT1RfRklMTFdJRFRIJyk7XG4gIFxuICAgIC8vIENoaWxkIGV2ZW50c1xuICAgIEFEVEVDSC5ldmVudCgnUllPVF9DSElMRF9NRVRBJyk7XG4gICAgQURURUNILmV2ZW50KCdSWU9UX0NISUxEX1JFU0laRScpO1xuICBcbiAgfTtcbiAgXG4gIC8qKlxuICAgKiBwcmVJbml0IE1ldGhvZFxuICAgKi9cbiAgY3VzdG9tQWQucHJvdG90eXBlLnByZUluaXQgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAod2luZG93PT1udWxsKSByZXR1cm47XG4gICAgd2luZG93LmNvbSA9IGNvbSB8fCB7fTtcbiAgICBjb20uYWR0ZWNoID0gd2luZG93LmNvbS5hZHRlY2g7XG4gIH07XG4gIFxuICAvKipcbiAgICogSW5pdCBjdXN0b21BZFxuICAgKi9cbiAgY3VzdG9tQWQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbihhZHZlcnQpIHtcbiAgICBcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gIFxuICAgIC8vIEFEVEVDSCBhZHZlcnQgZGF0YSBvYmplY3RcbiAgICB0aGlzLmFkdmVydCA9IGFkdmVydDtcbiAgXG4gICAgLy8gRWxlbWVudHNcbiAgICB0aGlzLmVsZW0uYWRDb250YWluZXIgPSBhZHZlcnQuYXNzZXRDb250YWluZXJzLm1haW4uYW5jaG9yRGl2O1xuICAgIHRoaXMuZWxlbS5hZENvbnRlbnQgPSBhZHZlcnQuYXNzZXRDb250YWluZXJzLm1haW4uYW5jaG9yRGl2LmZpcnN0Q2hpbGQ7XG4gICAgdGhpcy5lbGVtLmFkSWZyYW1lID0gdGhpcy5lbGVtLmFkQ29udGVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaWZyYW1lJylbMF07XG4gICAgdGhpcy5lbGVtLmFkQm9keSA9IGRvY3VtZW50IHx8IHRoaXMuZWxlbS5hZElmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50O1xuICBcbiAgICAvLyBBRFRFQ0ggbGlicmFyaWVzXG4gICAgdGhpcy5saWIgPSB7fTtcbiAgICB0aGlzLmxpYi51dGlscyA9IHRhcmdldFdpbmRvdy5jb20uYWR0ZWNoLlV0aWxzXyRWRVJTSU9OJDtcbiAgICB0aGlzLmxpYi5nbG9iYWxFdmVudEJ1cyA9IHRhcmdldFdpbmRvdy5hZHRlY2hBZE1hbmFnZXJfJFZFUlNJT04kLmdsb2JhbEV2ZW50QnVzO1xuICAgIHRoaXMubGliLnJpY2hNZWRpYUV2ZW50ID0gdGFyZ2V0V2luZG93LmNvbS5hZHRlY2guUmljaE1lZGlhRXZlbnRfJFZFUlNJT04kO1xuICBcbiAgICAvLyBNZXRhIGRhdGEgdG8gcGFzcyB0byBjaGlsZFxuICAgIHRoaXMubWV0YURhdGEgPSB7fTtcbiAgXG4gICAgLy8gU2V0dXAgcmVjaWV2ZXJcbiAgICB0aGlzLnJlY2lldmVNZXRhKCk7ICBcbiAgfTtcbiAgXG4gIC8qKlxuICAgKiBQYXJlbnQgZGF0YSBvYmplY3RcbiAgICovXG4gIGN1c3RvbUFkLnByb3RvdHlwZS5kYXRhID0ge1xuICAgIHRvcFBvc2l0aW9uIDogMCxcbiAgICBzY3JvbGxUb3AgOiAwLFxuICAgIHdpbldpZHRoIDogMCxcbiAgICB3aW5IZWlnaHQgOiAwLFxuICAgIGRvY0hlaWdodCA6IDBcbiAgfTtcbiAgXG4gIC8qKlxuICAgKiBDaGlsZCBkYXRhXG4gICAqL1xuICAvLyBjdXN0b21BZC5wcm90b3R5cGUuY2hpbGREYXRhID0ge31cbiAgXG4gIC8qKlxuICAgKiBGaXJlIHRoaXMgc3R1ZmYgd2hlbiByZWFkeSAoY2hpbGQgbWV0YSBpcyByZWNpZXZlZClcbiAgICovXG4gIGN1c3RvbUFkLnByb3RvdHlwZS53aGVuUmVhZHkgPSBmdW5jdGlvbigpIHtcbiAgICAvLyBQcm9jZXNzIGRhdGEgZnJvbSBwYXJlbnRcbiAgICB0aGlzLmhhbmRsZVBhcmVudERhdGEoKTtcbiAgICAvLyBTZXR1cCBkaXNwYXRjaGVyXG4gICAgdGhpcy5zZW5kTWV0YSgpO1xuICB9O1xuICBcbiAgLyoqXG4gICAqIEhhbmRsZSBQYXJlbnQgZGF0YVxuICAgKi9cbiAgY3VzdG9tQWQucHJvdG90eXBlLmhhbmRsZVBhcmVudERhdGEgPSBmdW5jdGlvbigpIHtcbiAgICAvLyBTY3JvbGwgcG9zaXRpb25cbiAgICB0aGlzLnNldHVwU2Nyb2xsRGF0YSgpO1xuICAgIC8vIEdldCBBZCB3cmFwcGVyIHBvc2l0aW9uIGRhdGFcbiAgICB0aGlzLmdldEFkV3JhcHBlclBvc2l0aW9uKCk7XG4gICAgLy8gU2V0IGFkdmVydCB3cmFwcGVyIGhlaWdodFxuICAgIHRoaXMuc2V0QWRIZWlnaHQoKTtcbiAgICAvLyBTZXR1cCByZXNpemUgZXZlbnRcbiAgICB0aGlzLnNldHVwUmVzaXplKCk7XG4gICAgLy8gRm9jdXMgaWZyYW1lXG4gICAgdGhpcy5lbGVtLmFkSWZyYW1lLmNvbnRlbnRXaW5kb3cuZm9jdXMoKTtcbiAgfTtcbiAgXG4gIC8qKlxuICAgKiBEaXNwYXRjaCBldmVudCB0byBjaGlsZFxuICAgKi9cbiAgY3VzdG9tQWQucHJvdG90eXBlLmRpc3BhdGNoRXZlbnQgPSBmdW5jdGlvbihldmVudE5hbWUsIGRhdGEpIHtcbiAgICB2YXIgcmljaE1lZGlhRXZlbnQgPSBuZXcgdGhpcy5saWIucmljaE1lZGlhRXZlbnQoZXZlbnROYW1lKTtcbiAgICB2YXIgZGF0YSA9IGRhdGEgfHwge307XG4gICAgcmljaE1lZGlhRXZlbnQubWV0YSA9IGRhdGE7XG4gICAgdGhpcy5hZHZlcnQuZXZlbnRCdXMuZGlzcGF0Y2hFdmVudChyaWNoTWVkaWFFdmVudCk7XG4gIH07XG4gIFxuICAvKipcbiAgICogU2VuZCBtZXRhIGRhdGEgdG8gY2hpbGQgKGFkdmVydClcbiAgICovXG4gIGN1c3RvbUFkLnByb3RvdHlwZS5zZW5kTWV0YSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgIHNlbGYuZGlzcGF0Y2hFdmVudCgnUllPVF9QQVJFTlRfTUVUQScsIHNlbGYuZGF0YSk7XG4gICAgfSwgMTAwKTtcbiAgfTtcbiAgXG4gIC8qKlxuICAgKiBSZWNpZXZlIG1ldGEgZGF0YSBmcm9tIGNoaWxkXG4gICAqL1xuICBjdXN0b21BZC5wcm90b3R5cGUucmVjaWV2ZU1ldGEgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgLy8gTWV0YSBkYXRhXG4gICAgdGhpcy5hZHZlcnQuZXZlbnRCdXMuYWRkRXZlbnRMaXN0ZW5lcignUllPVF9DSElMRF9NRVRBJywgZnVuY3Rpb24oZSkge1xuICAgICAgc2VsZi5kYXRhLmRvY0hlaWdodCA9IGUubWV0YS5kb2NIZWlnaHQ7XG4gICAgICAvLyBTZXQgYWR2ZXJ0IHdyYXBwZXIgaGVpZ2h0XG4gICAgICBzZWxmLnNldEFkSGVpZ2h0KGUubWV0YS5kb2NIZWlnaHQsIHRydWUpO1xuICAgICAgLy8gTWV0YSBpcyByZWFkeSwgc28gZmlyZVxuICAgICAgc2VsZi53aGVuUmVhZHkoKTtcbiAgICB9KTtcbiAgICAvLyBDaGVjayBpZiB3cmFwcGVyIHNob3VsZCBmaWxsIGNvbnRhaW5lclxuICAgIHRoaXMuYWR2ZXJ0LmV2ZW50QnVzLmFkZEV2ZW50TGlzdGVuZXIoJ1JZT1RfRklMTFdJRFRIJywgZnVuY3Rpb24oZSkge1xuICAgICAgc2VsZi5zZXRBZFRvRmlsbENvbnRhaW5lcigpO1xuICAgICAgc2VsZi5zZXRBZEhlaWdodChzZWxmLmRhdGEuZG9jSGVpZ2h0KTtcbiAgICB9KTtcbiAgfTtcbiAgXG4gIC8qKlxuICAgKiBcbiAgICovXG4gIGN1c3RvbUFkLnByb3RvdHlwZS5nZXRBZFdyYXBwZXJQb3NpdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtLmFkQ29udGFpbmVyO1xuICAgIHZhciBib2R5UmVjdCA9IGRvY3VtZW50LmJvZHkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICAgIGVsZW1SZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgdG9wID0gZWxlbVJlY3QudG9wIC0gYm9keVJlY3QudG9wO1xuICAgIHRoaXMuZGF0YS50b3BQb3NpdGlvbiA9IHRvcDtcbiAgfSxcbiAgXG4gIC8qKlxuICAgKiBcbiAgICovXG4gIGN1c3RvbUFkLnByb3RvdHlwZS5zZXR1cFNjcm9sbERhdGEgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHdoZWVsLCBmYWxzZSApO1xuICAgIGZ1bmN0aW9uIGdldFNjcm9sbFRvcCgpIHtcbiAgICAgIHZhciBkb2MgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgICB2YXIgdG9wID0gKHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2Muc2Nyb2xsVG9wKSAgLSAoZG9jLmNsaWVudFRvcCB8fCAwKTtcbiAgICAgIHJldHVybiB0b3A7XG4gICAgfVxuICAgIHZhciBsYXN0T2Zmc2V0ID0gZ2V0U2Nyb2xsVG9wKCk7XG4gICAgdmFyIGxhc3REYXRlID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgZnVuY3Rpb24gd2hlZWwoZSkge1xuICAgICAgc2VsZi5kYXRhLnNjcm9sbFRvcCA9IGdldFNjcm9sbFRvcCgpO1xuICAgIH1cbiAgICB0aGlzLmRhdGEuc2Nyb2xsVG9wID0gZ2V0U2Nyb2xsVG9wKCk7XG4gIH1cbiAgXG4gIGN1c3RvbUFkLnByb3RvdHlwZS5zZXR1cFJlc2l6ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgd2luU2l6ZSA9IHNlbGYuZ2V0V2luZG93U2l6ZSgpO1xuICAgIHNlbGYuZGF0YS53aW5XaWR0aCA9IHdpblNpemUud2lkdGg7XG4gICAgc2VsZi5kYXRhLndpbkhlaWdodCA9IHdpblNpemUuaGVpZ2h0O1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBmdW5jdGlvbigpe1xuICAgICAgc2VsZi5kaXNwYXRjaEV2ZW50KCdSWU9UX1JFU0laRScsIHNlbGYuZGF0YSk7XG4gICAgfSwgdHJ1ZSk7XG4gICAgLy8gUmVjaWV2ZSBkYXRhXG4gICAgdGhpcy5hZHZlcnQuZXZlbnRCdXMuYWRkRXZlbnRMaXN0ZW5lcignUllPVF9DSElMRF9SRVNJWkUnLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgd2luU2l6ZSA9IHNlbGYuZ2V0V2luZG93U2l6ZSgpO1xuICAgICAgc2VsZi5kYXRhLndpbldpZHRoID0gd2luU2l6ZS53aWR0aDtcbiAgICAgIHNlbGYuZGF0YS53aW5IZWlnaHQgPSB3aW5TaXplLmhlaWdodDtcbiAgICAgIHNlbGYuc2V0QWRIZWlnaHQoZS5tZXRhLmRvY0hlaWdodCk7XG4gICAgfSk7XG4gIH07XG4gIFxuICBjdXN0b21BZC5wcm90b3R5cGUuZ2V0V2luZG93U2l6ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB3ID0gd2luZG93LFxuICAgICAgICBkID0gZG9jdW1lbnQsXG4gICAgICAgIGUgPSBkLmRvY3VtZW50RWxlbWVudCxcbiAgICAgICAgZyA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXSxcbiAgICAgICAgeCA9IHcuaW5uZXJXaWR0aCB8fCBlLmNsaWVudFdpZHRoIHx8IGcuY2xpZW50V2lkdGgsXG4gICAgICAgIHkgPSB3LmlubmVySGVpZ2h0fHwgZS5jbGllbnRIZWlnaHR8fCBnLmNsaWVudEhlaWdodDtcbiAgICByZXR1cm4ge1xuICAgICAgd2lkdGggOiB4LFxuICAgICAgaGVpZ2h0IDogeVxuICAgIH07XG4gIH07XG4gIFxuICBjdXN0b21BZC5wcm90b3R5cGUuc2V0QWRIZWlnaHQgPSBmdW5jdGlvbihoZWlnaHQsIGZvcmNlKSB7XG4gICAgXG4gICAgaWYgKHR5cGVvZiBoZWlnaHQgPT0gJ3VuZGVmaW5lZCcpIHJldHVybjtcbiAgICB2YXIgdG9wV3JhcHBlciA9IHRoaXMuZWxlbS5hZENvbnRhaW5lcjtcbiAgICB2YXIgY29udGVudFdyYXBwZXIgPSB0aGlzLmVsZW0uYWRDb250ZW50O1xuICAgIHZhciBpZnJhbWUgPSBjb250ZW50V3JhcHBlci5maXJzdENoaWxkO1xuICAgIHZhciBkb2NCb2R5ID0gdGhpcy5lbGVtLmRvY0JvZHk7XG4gIFxuICAgIC8vIFRvcCB3cmFwcGVyXG4gICAgLy8gdG9wV3JhcHBlci5zdHlsZS53aWR0aCA9IFwiYXV0b1wiO1xuICAgIHRvcFdyYXBwZXIuc3R5bGUuaGVpZ2h0ID0gXCJhdXRvXCI7XG4gIFxuICAgIC8vIFN0eWxlXG4gICAgY29udGVudFdyYXBwZXIuc3R5bGUuY2xpcCA9IFwiXCI7XG4gICAgdG9wV3JhcHBlci5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICB0b3BXcmFwcGVyLnN0eWxlLmxlZnQgPSAwO1xuICAgIHRvcFdyYXBwZXIuc3R5bGUudG9wID0gMDtcbiAgXG4gICAgaWYgKGhlaWdodCE9PXRoaXMuZGF0YS5kb2NIZWlnaHQgfHwgZm9yY2U9PXRydWUpIHtcbiAgXG4gICAgICAvLyB0aGlzLmRhdGEuZG9jSGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgLy8gaGVpZ2h0ID0gdGhpcy5kYXRhLmRvY0hlaWdodDtcbiAgXG4gICAgICAvLyB0b3BXcmFwcGVyLnN0eWxlLmhlaWdodCA9IDAgKyBcInB4XCI7XG4gICAgICB0b3BXcmFwcGVyLnN0eWxlLmhlaWdodCA9IGhlaWdodCArIFwicHhcIjtcbiAgICAgIC8vIFxuICAgICAgLy8gY29udGVudFdyYXBwZXIuc3R5bGUuaGVpZ2h0ID0gMCArIFwicHhcIjtcbiAgICAgIGNvbnRlbnRXcmFwcGVyLnN0eWxlLmhlaWdodCA9IGhlaWdodCArIFwicHhcIjtcbiAgICAgIC8vIFxuICAgICAgLy8gaWZyYW1lLnN0eWxlLmhlaWdodCA9IDAgKyBcInB4XCI7XG4gICAgICBpZnJhbWUuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgXCJweFwiO1xuICBcbiAgICAgIC8vIEZpbmFsaXNlXG4gICAgICB0aGlzLmRhdGEuZG9jSGVpZ2h0ID0gaGVpZ2h0O1xuICAgIH1cbiAgfTtcbiAgXG4gIGN1c3RvbUFkLnByb3RvdHlwZS5zZXRBZFRvRmlsbENvbnRhaW5lciA9IGZ1bmN0aW9uKCkge1xuICAgIFxuICAgIHZhciB0b3BXcmFwcGVyID0gdGhpcy5lbGVtLmFkQ29udGFpbmVyO1xuICAgIHZhciBjb250ZW50V3JhcHBlciA9IHRoaXMuZWxlbS5hZENvbnRlbnQ7XG4gICAgdmFyIGlmcmFtZSA9IGNvbnRlbnRXcmFwcGVyLmZpcnN0Q2hpbGQ7XG4gICAgdmFyIGRvY0JvZHkgPSB0aGlzLmVsZW0uZG9jQm9keTtcbiAgXG4gICAgdG9wV3JhcHBlci5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuICAgIGNvbnRlbnRXcmFwcGVyLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gICAgaWZyYW1lLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gICAgaWZyYW1lLndpZHRoID0gXCIxMDAlXCI7XG4gIFxuICAgIC8vIFNldCBhZHZlcnQgd3JhcHBlciBoZWlnaHRcbiAgICB0aGlzLnNldEFkSGVpZ2h0KCk7XG4gIH07XG5cbiAgdGFyZ2V0V2luZG93LmFkdGVjaENhbGxiYWNrSW5zdGFuY2VzID0gdGFyZ2V0V2luZG93LmFkdGVjaENhbGxiYWNrSW5zdGFuY2VzIHx8IFtdO1xuICB2YXIgaW5zdGFuY2VJbmRleCA9IHRhcmdldFdpbmRvdy5hZHRlY2hDYWxsYmFja0luc3RhbmNlcy5sZW5ndGg7XG4gIHRhcmdldFdpbmRvdy5hZHRlY2hDYWxsYmFja0luc3RhbmNlc1tpbnN0YW5jZUluZGV4XSA9IG5ldyB0YXJnZXRXaW5kb3cuY29tLmFkdGVjaC5BZHRlY2hDdXN0b21BZCRBRF9JRCQoKTtcblxuICB0YXJnZXRXaW5kb3cuYWR0ZWNoQWRDYWxsYmFja3MgPSB0YXJnZXRXaW5kb3cuYWR0ZWNoQWRDYWxsYmFja3MgfHwge307XG4gIHRhcmdldFdpbmRvdy5hZHRlY2hBZENhbGxiYWNrc1thZENvbmZpZy5hZFNlcnZlclZhcnMudWlkXSA9XG4gICAgICB0YXJnZXRXaW5kb3cuYWR0ZWNoQWRDYWxsYmFja3NbYWRDb25maWcuYWRTZXJ2ZXJWYXJzLnVpZF0gfHwgW107XG4gIHRhcmdldFdpbmRvdy5hZHRlY2hBZENhbGxiYWNrc1thZENvbmZpZy5hZFNlcnZlclZhcnMudWlkXS5wdXNoKFxuICAgICAgdGFyZ2V0V2luZG93LmFkdGVjaENhbGxiYWNrSW5zdGFuY2VzW2luc3RhbmNlSW5kZXhdKTtcbn0pKGFkdGVjaEFkQ29uZmlnKTsiXX0=
